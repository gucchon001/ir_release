# 機能要件仕様書

## 1. システム概要
- **プログラムの全体的な目的と対象のユーザー**:
  - このプログラムは、EDINET APIを利用して有価証券報告書などの財務書類を取得し、その内容をPDFとして保存し、要約を生成してGoogle Driveに保存します。また、生成された要約をSlackを通じて通知します。対象ユーザーは、企業の財務情報を迅速に把握したい投資家やアナリスト、企業内の財務担当者です。

## 2. 主要機能要件
- **EDINET APIからの文書取得**:
  - 指定された日付範囲内でEDINET APIを通じて財務文書を取得します。取得した文書はEDINETコードに基づいてフィルタリングされます。

- **PDFのテキスト抽出と要約**:
  - PDFからテキストを抽出し、OpenAIのAPIを利用してテキストを要約します。要約は複数のチャンクに分割して処理され、最終的に一つの要約としてまとめられます。

- **Google Driveへの保存**:
  - 取得したPDFおよび生成された要約をGoogle Driveに保存します。ファイルは特定のフォルダに整理され、既存の同名ファイルがある場合は上書きを避けます。

- **Slack通知**:
  - 要約が生成されると、Slackを通じて指定されたチャンネルに通知を送信します。通知には要約の内容と関連するIRページへのリンクが含まれます。

- **スプレッドシートのデータ処理**:
  - GoogleスプレッドシートからEDINETコードを取得し、それに基づいて文書の取得と処理を行います。処理結果はスプレッドシートにログとして記録されます。

## 3. 非機能要件
- **パフォーマンス**:
  - 大量のPDFを並列で処理するために、ThreadPoolExecutorを使用しています。これにより、処理速度を向上させています。
  
- **セキュリティ**:
  - APIキーやサービスアカウント情報は環境変数や設定ファイルで管理され、不正アクセスを防ぎます。
  - Slack通知やGoogle Driveへのアクセスは、適切な認証を経て行われます。

- **可用性**:
  - ログを詳細に記録し、エラー発生時には適切にハンドリングすることで、システムの可用性を高めています。

## 4. 技術要件
- **開発環境**:
  - Python 3.xが必要です。
  - 必要な外部ライブラリは`requirements.txt`に記載されており、`pip`でインストール可能です。

- **システム環境**:
  - Google Cloud Platformを利用したGoogle Drive APIおよびGoogle Sheets APIの使用が必要です。
  - OpenAI APIを使用するためのAPIキーが必要です。

- **必要なライブラリ**:
  - `openai`, `google-auth`, `google-api-python-client`, `requests`, `pymupdf`, `slack_sdk`, `dotenv`, `tiktoken`, `sentence_transformers`などが使用されています。

このプログラムは、投資家や企業の財務担当者が迅速かつ効率的に情報を取得し、処理できるよう設計されています。各機能は独立しており、モジュール化されているため、個々の機能の拡張や改善が容易です。